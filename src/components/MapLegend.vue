<template>
  <div id="legendContainer">
    <div
      v-show="!hidden"
      id="tabs"
    >
      <div
        id="minimizeTab"
        class="tab"
      >
        <a
          id="legendMinimize"
          class="tabIcon"
          aria-label="close legend dialog box"
          @click="runGoogleAnalytics('legend', 'click', 'user reduced legend'), legendToggle()"
        >
          <font-awesome-icon icon="angle-down" />
        </a>
      </div>
      <div
        v-if="currentFeature === 'waterStorage'"
        id="infoTab"
        class="tab"
      >
        <a
          id="legendInfoButton"
          class="tabIcon"
          aria-label="open information dialog box"
          @click="runGoogleAnalytics('legend', 'click', 'user clicked info icon'), modalToggle()"
        >
          <font-awesome-icon
            v-if="!infoShowing"
            icon="info"
          />
          <font-awesome-icon
            v-else
            icon="list"
          />
        </a>
      </div>
    </div>
    <div
      v-show="!hidden && !infoShowing"
      id="legend"
    >
      <div id="legendTitle">
        <p>{{ legendTitle }}</p>
      </div>
      <div id="keysAndText" />
    </div>
    <LegendModal
      v-show="infoShowing && !hidden"
      @clickedX="modalToggle()"
    />
    <div
      v-show="hidden"
      id="collapsedLegend"
    >
      <div id="collaspedLegendText">
        <p>Legend</p>
      </div>
      <div id="collapsedLegendIcon">
        <a
          id="legendPlus"
          class="legendIcon"
          aria-label="close extended legend box"
          @click="runGoogleAnalytics('legend', 'click', 'user expanded legend'), legendToggle()"
        >
          <font-awesome-icon icon="angle-left" />
        </a>
      </div>
    </div>
  </div>
</template>

<script>
import mapStyles from "../assets/mapStyles/waterStorage/mapStyles";
import LegendModal from "./LegendModal";

export default {
  name: "MapLegend",
  components:{
    LegendModal
  },
  props: {
    legendTitle: {
      type: String,
      default: "Add your title for the legend in MapBox.vue or make this blank"
    },
    useParameter: {
      type: String,
      default: "te"
    }
  },
  data() {
    return {
      legend: null,
      hidden: false,
      infoShowing: false,
      currentFeature: this.$route.name,
      waterUseParameter: this.useParameter
    };
  },
  mounted() {
    if(this.currentFeature === "waterStorage"){
      this.createWaterStorageLegend();
    }else if(this.currentFeature === "waterTemperature"){
      this.createWaterTempLegend();
    }
    this.$root.$on("SwapLegendIcon", () => {
      this.SwapLegendIcon();
    });
  },
  methods: {
    runGoogleAnalytics(eventName, action, label) {
      this.$ga.set({ dimension2: Date.now() });
      this.$ga.event(eventName, action, label);
    },
    legendToggle(){
      this.hidden = !this.hidden;
    },
    modalToggle(){
      this.infoShowing = !this.infoShowing;
    },
    createWaterStorageLegend() {
      // get the style layers from the map styles object
      let styleLayers = mapStyles.style.layers;
      let legendColorValues = [];
      let styleSheetCategories = [];
      let selectedLayerStyle = null;
      // look through the styles layers to find the one with the Hydrological Response Unit fill colors
      for (let index = 0; index < styleLayers.length; index++) {
        if (styleLayers[index].id === "HRUs") {
          // save the layer style we want, so we can use it later
          selectedLayerStyle = styleLayers[index];
          // Get the fill color values and names then put them in separate lists
          let styleSheetColorStops =
            styleLayers[index].paint["fill-color"].stops;
          let styleSheetColorLabel = null;
          for (let index = 0; index < styleSheetColorStops.length; index++) {
            // Make a label for the blank and missing data

            styleSheetColorLabel = styleSheetColorStops[index][0];
            legendColorValues.push(styleSheetColorStops[index][1]);
            styleSheetCategories.push(styleSheetColorLabel);
          }
        }
      }

      let legend = this.legend;
      legend = document.getElementById("keysAndText");

      for (let index = 0; index < styleSheetCategories.length; index++) {
        let legendMainText = styleSheetCategories[index];
        let color = legendColorValues[index];
        let item = document.createElement("div");
        let keyContainer = document.createElement("div");
        let textContainer = document.createElement("div");
        let key = document.createElement("div");
        let value = document.createElement("div");

        item.style.minHeight = "20px";
        item.style.display = "flex";

        keyContainer.style.flex = 1;

        textContainer.style.flex = 1;

        key.style.backgroundColor = color;
        key.style.height = "25px";

        value.style.fontSize = ".85em";
        value.style.userSelect = "none";
        value.style.lineHeight = "25px";
        value.style.paddingLeft = "10px";
        value.innerHTML = selectedLayerStyle.legendText[legendMainText][0];

        keyContainer.appendChild(key);
        textContainer.appendChild(value);
        item.appendChild(keyContainer);
        item.appendChild(textContainer);
        legend.appendChild(item);
      }
    },
    createWaterTempLegend(){
      let keys = document.getElementById("keysAndText");
      //create main container
      let mainContainer = document.createElement('div');
      mainContainer.id = "mainContainer";

      let mainContainerContent = document.createElement('div');
      mainContainerContent.id = "mainContainerContent";
      //create gradient container
      let gradientContainer = document.createElement('div');
      gradientContainer.id = "legendGradientContainer";
      //create gradient
      let gradient = document.createElement('div');
      gradient.id = "legendGradient";
      //create temps container
      let tempContainer = document.createElement('div');
      tempContainer.id = "tempContainer";
      //create top temp div
      let topTemp = document.createElement('div');
      topTemp.id = "topTemp";
      topTemp.innerHTML = "30-27&#8451; | 86-81&#8457;";
      //second hottest
      let secondHot = document.createElement('div');
      secondHot.id = "secondHot";
      secondHot.innerHTML = "26-24&#8451; | 79-75&#8457;";
      //third hottest
      let thirdHot = document.createElement('div');
      thirdHot.id = "thirdHot";
      thirdHot.innerHTML = "23-21&#8451; | 73-69&#8457;"
      //fourth hottest
      let fourthHot = document.createElement('div');
      fourthHot.id = "fourthHot";
      fourthHot.innerHTML = "20-18&#8451; | 68-64&#8457;"
      //create middle temp div
      let middleTemp = document.createElement('div');
      middleTemp.id = "middleTemp";
      middleTemp.innerHTML = "17-15&#8451; | 63-59&#8457;"
      //14-12
      let firstLower = document.createElement('div');
      firstLower.id = "firstLower";
      firstLower.innerHTML= "14-12&#8451; | 57-53&#8457"
      //11-9
      let secondLower = document.createElement('div');
      secondLower.id = "secondLower";
      secondLower.innerHTML= "11-9&#8451;&nbsp;&nbsp; | 51-48&#8457"
      //8-6
      let thirdLower = document.createElement('div');
      thirdLower.id = "thirdLower";
      thirdLower.innerHTML= "8-6&#8451;&nbsp;&nbsp;&nbsp;&nbsp; | 46-42&#8457"
      //5-3
      let fourthLower = document.createElement('div');
      fourthLower.id = "fourthLower";
      fourthLower.innerHTML= "5-3&#8451;&nbsp;&nbsp;&nbsp;&nbsp; | 41-37&#8457"
      //create bottom temp div
      let bottomTemp = document.createElement('div');
      bottomTemp.id = "bottomTemp";
      bottomTemp.innerHTML = "2-0&#8451;&nbsp;&nbsp;&nbsp;&nbsp; | 35-32&#8457;"
      //add classes to temp divs
      topTemp.classList.add('temp');
      secondHot.classList.add('temp');
      thirdHot.classList.add('temp');
      fourthHot.classList.add('temp');
      firstLower.classList.add('temp');
      secondLower.classList.add('temp');
      thirdLower.classList.add('temp');
      fourthLower.classList.add('temp');
      bottomTemp.classList.add('temp');
      //create site legend content
      let siteContainer = document.createElement('div');
      siteContainer.id = "siteContainer";
      let siteDot = document.createElement('div');
      siteDot.classList.add('siteDot');
      let siteDotText = document.createElement('div');
      siteDotText.id = "siteDotText";
      siteDotText.innerHTML = "USGS monitoring station";
      //append divs to parents
      siteContainer.appendChild(siteDot);
      siteContainer.appendChild(siteDotText);
      gradientContainer.appendChild(gradient);
      tempContainer.appendChild(topTemp);
      tempContainer.appendChild(secondHot);
      tempContainer.appendChild(thirdHot);
      tempContainer.appendChild(fourthHot);
      tempContainer.appendChild(middleTemp);
      tempContainer.appendChild(firstLower);
      tempContainer.appendChild(secondLower);
      tempContainer.appendChild(thirdLower);
      tempContainer.appendChild(fourthLower);
      tempContainer.appendChild(bottomTemp);
      mainContainerContent.appendChild(gradientContainer);
      mainContainerContent.appendChild(tempContainer);
      mainContainer.appendChild(mainContainerContent);
      keys.appendChild(mainContainer);
      keys.appendChild(siteContainer);
    },
    SwapLegendIcon(){
      this.waterUseParameter = this.useParameter;
    }
  }
};
</script>

<style scoped lang="scss">
$border: 1px solid rgb(200, 200, 200);
$background: rgb(255, 255, 255);
$borderRadius: 5px;
$fontSizeMobile: 0.8em;
$fontSizeDesktop: 0.9em;
$arrowHeight: 21px;
$arrowWidth: 21px;
$buttonColorActive: #003366;
$buttonActiveTextColor: #fff;

#legendContainer {
  display: flex;
  min-height: 20px;
  min-width: 100px;
  position: absolute;
  bottom: 10px;
  left: 10px;
  z-index: 1000;
  p{
    margin:0;
  }
  a{
    display: inline-block;
    width:100%;
    height: 100%;
    text-align: center;
    cursor: pointer;
  }
}
#legend{
  background: $background;
  border: $border;
  border-radius: $borderRadius 0 $borderRadius $borderRadius;
  overflow: hidden;
  font-size: .85em;
}
#collapsedLegend{
  display: flex;
  border: $border;
  background: $background;
  border-radius: $borderRadius;
  overflow: hidden;
}
#collaspedLegendText{
  flex: 1;
  padding: 5px 5px;
  font-size:.9em;
}
#collapsedLegendIcon{
  width: 25px;
  border-left: $border;
  a{
    &:active{
      background: $buttonColorActive;
      color: $buttonActiveTextColor;
    }
    svg{
      height: $arrowHeight;
      width: $arrowWidth;
      margin: 3px 0 0 0;
    }
  }
}
#tabs {
  align-self: flex-start;
  width: 25px;
  order: 2;
  background: $background;
  border-radius: 0 $borderRadius $borderRadius 0;
  border-top: $border;
  border-right: $border;
}
#tabs,
#collapsedLegendIcon
{
  a{
    &:hover{
      background: $buttonColorActive;
      color: $buttonActiveTextColor;
    }
  } 
}
.tab {
  height: 30px;
}
.tabIcon {
  display: inline-block;
  width: 100%;
  height: 100%;
  text-align: center;
  cursor: pointer;
  &:active {
    background: $buttonColorActive;
    color: $buttonActiveTextColor;
  }
  svg {
    margin: 7px 0 0 0;
  }
}
#legendMinimize{
  border-bottom: $border;
  svg{
    height: $arrowHeight;
    width: $arrowWidth;
    margin: 4px 0 0 0;
  }
}
#legendTitle {
  padding: 0 5px;
  border-bottom: $border;
  height: 30px;
  line-height: 30px;
  p {
    font-size: 0.9em;
  }
}
</style>
<style lang="scss">
#mainContainer{
  display: flex;
  padding: 5px 10px;
}
#mainContainerContent{
  display: flex;
  flex-wrap: wrap;
}
#legendGradientContainer{
  padding: 5px 0;
}
#legendGradient{
  background-image: linear-gradient(180deg,#67001f,#b2182b,#d6604d,#f4a582,#fddbc7,#d1e5f0,#92c5de,#4393c3,#2166ac,#053061);
  min-height: 200px;
  width: 30px;
  margin: 0 5px 0 0;
  border-radius: 5px;
  
}
#tempContainer{
  flex: 1;
  display: flex;
  flex-direction: column;
}
.temp{
  flex: 1;
}
#bottomTemp{
  position: relative;
  div{
    position: absolute;
    bottom: 0;
  }
}
#siteContainer{
  display: flex;
  padding: 10px;
  align-items: center;
  .siteDot{
    background: #000000;
    width:6px;
    height: 6px;
    border-radius: 5px;
    border: 1px solid #000000;
    margin-right: 5px;
  }
}
</style>
